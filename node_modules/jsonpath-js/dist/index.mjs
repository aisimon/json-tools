var Qs=Object.create;var Bt=Object.defineProperty;var Bs=Object.getOwnPropertyDescriptor;var _s=Object.getOwnPropertyNames;var Us=Object.getPrototypeOf,Ws=Object.prototype.hasOwnProperty;var zs=(n,o)=>()=>(o||n((o={exports:{}}).exports,o),o.exports);var Gs=(n,o,t,l)=>{if(o&&typeof o=="object"||typeof o=="function")for(let g of _s(o))!Ws.call(n,g)&&g!==t&&Bt(n,g,{get:()=>o[g],enumerable:!(l=Bs(o,g))||l.enumerable});return n};var Hs=(n,o,t)=>(t=n!=null?Qs(Us(n)):{},Gs(o||!n||!n.__esModule?Bt(t,"default",{value:n,enumerable:!0}):t,n));var Wt=zs((xo,Ut)=>{"use strict";function _t(n,o){return o.reduce(function(t,l){return{type:"LogicalBinary",operator:l[1],left:t,right:l[3]}},n)}function qs(n,o){return n?{type:"LogicalUnary",operator:"!",expr:o}:o}var G=class extends SyntaxError{constructor(o,t,l,g){super(o),this.expected=t,this.found=l,this.location=g,this.name="SyntaxError"}format(o){let t="Error: "+this.message;if(this.location){let l=null,g=o.find(b=>b.source===this.location.source);g&&(l=g.text.split(/\r\n|\n|\r/g));let h=this.location.start,C=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(h):h,S=this.location.source+":"+C.line+":"+C.column;if(l){let b=this.location.end,P="".padEnd(C.line.toString().length," "),_=l[h.line-1],A=(h.line===b.line?b.column:_.length+1)-h.column||1;t+=`
 --> `+S+`
`+P+` |
`+C.line+" | "+_+`
`+P+" | "+"".padEnd(h.column-1," ")+"".padEnd(A,"^")}else t+=`
 at `+S}return t}static buildMessage(o,t){function l(A){return A.codePointAt(0).toString(16).toUpperCase()}let g=Object.prototype.hasOwnProperty.call(RegExp.prototype,"unicode")?new RegExp("[\\p{C}\\p{Mn}\\p{Mc}]","gu"):null;function h(A){return g?A.replace(g,x=>"\\u{"+l(x)+"}"):A}function C(A){return h(A.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,x=>"\\x0"+l(x)).replace(/[\x10-\x1F\x7F-\x9F]/g,x=>"\\x"+l(x)))}function S(A){return h(A.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,x=>"\\x0"+l(x)).replace(/[\x10-\x1F\x7F-\x9F]/g,x=>"\\x"+l(x)))}let b={literal(A){return'"'+C(A.text)+'"'},class(A){let x=A.parts.map(D=>Array.isArray(D)?S(D[0])+"-"+S(D[1]):S(D));return"["+(A.inverted?"^":"")+x.join("")+"]"+(A.unicode?"u":"")},any(){return"any character"},end(){return"end of input"},other(A){return A.description}};function P(A){return b[A.type](A)}function _(A){let x=A.map(P);if(x.sort(),x.length>0){let D=1;for(let k=1;k<x.length;k++)x[k-1]!==x[k]&&(x[D]=x[k],D++);x.length=D}switch(x.length){case 1:return x[0];case 2:return x[0]+" or "+x[1];default:return x.slice(0,-1).join(", ")+", or "+x[x.length-1]}}function re(A){return A?'"'+C(A)+'"':"end of input"}return"Expected "+_(o)+" but "+re(t)+" found."}};function Xs(n,o){o=o!==void 0?o:{};let t={},l=o.grammarSource,g={JsonpathQuery:Ee},h=Ee,C="$",S='"',b="'",P="\\",_="b",re="f",A="n",x="r",D="t",k="/",ze="u",Ne="d",gr="*",mr="0",yr="-",Ge=":",hr="?",ne="||",se="&&",He="(",qe=")",dr="!",$r="@",Xe="==",Ke="!=",Ye="<=",Ze=">=",xe="[",Ae="]",Fe=".",et="-0",Nr="e",tt="true",rt="false",nt="null",oe=",",st="..",xr=/^[\t-\n\r ]/,Ar=/^[ -!#-&(-[\]-\uD7FF\uE000-\uFFFF]/,ot=/^[\uD800-\uDBFF]/,it=/^[\uDC00-\uDFFF]/,Fr=/^[ABCEF]/i,Cr=/^[0-7]/,br=/^[89AB]/i,Sr=/^[CDEF]/i,Lr=/^[ABCDEF]/i,Tr=/^[1-9]/,Er=/^[<>]/,wr=/^[\-+]/,Jr=/^[0-9_a-z]/,Dr=/^[a-z]/,vr=/^[_\x80-\uD7FF\uE000-\uFFFF]/,Rr=/^[0-9]/,Or=/^[a-z]/i,Ir=L([["	",`
`],"\r"," "],!1,!1,!1),jr=d("$",!1),ie=d('"',!1),fe=d("'",!1),Ce=d("\\",!1),Pr=L([[" ","!"],["#","&"],["(","["],["]","\uD7FF"],["\uE000","\uFFFF"]],!1,!1,!1),ft=L([["\uD800","\uDBFF"]],!1,!1,!1),lt=L([["\uDC00","\uDFFF"]],!1,!1,!1),Mr=d("b",!1),Vr=d("f",!1),kr=d("n",!1),Qr=d("r",!1),Br=d("t",!1),_r=d("/",!1),at=d("u",!1),Ur=L(["A","B","C","E","F"],!1,!0,!1),be=d("D",!0),Wr=L([["0","7"]],!1,!1,!1),zr=L(["8","9","A","B"],!1,!0,!1),Gr=L(["C","D","E","F"],!1,!0,!1),Hr=L(["A","B","C","D","E","F"],!1,!0,!1),qr=d("*",!1),Xr=d("0",!1),Kr=d("-",!1),Yr=L([["1","9"]],!1,!1,!1),ct=d(":",!1),Zr=d("?",!1),ut=d("||",!1),pt=d("&&",!1),gt=d("(",!1),mt=d(")",!1),en=d("!",!1),tn=d("@",!1),rn=d("==",!1),nn=d("!=",!1),sn=d("<=",!1),on=d(">=",!1),fn=L(["<",">"],!1,!1,!1),Se=d("[",!1),Le=d("]",!1),Te=d(".",!1),ln=d("-0",!1),an=d("e",!0),cn=L(["-","+"],!1,!1,!1),un=d("true",!1),pn=d("false",!1),gn=d("null",!1),mn=L([["0","9"],"_",["a","z"]],!1,!1,!1),yn=L([["a","z"]],!1,!1,!1),le=d(",",!1),hn=L(["_",["\x80","\uD7FF"],["\uE000","\uFFFF"]],!1,!1,!1),dn=L([["0","9"]],!1,!1,!1),$n=L([["a","z"]],!1,!0,!1),Nn=d("..",!1);function xn(e){return{type:"Root",segments:e}}function An(e){return{type:"NameSelector",member:e}}function Fn(e){return e.join("")}function Cn(e){return e.join("")}function bn(){return"\b"}function Sn(){return"\f"}function Ln(){return`
`}function Tn(){return"\r"}function En(){return"	"}function wn(){return"/"}function Jn(){return"\\"}function Dn(e){return String.fromCharCode(...e)}function vn(e){return[e]}function co(e){return e}function Rn(){return parseInt(W(),16)}function On(){return parseInt(W(),16)}function In(){return parseInt(W(),16)}function jn(){return parseInt(W(),16)}function Pn(){return{type:"WildcardSelector"}}function Mn(e){return{type:"IndexSelector",index:e}}function Vn(){return 0}function kn(){let e=parseInt(W());if(Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER)return e;throw new Error(`Index must be within the range of I-JSON: ${e}`)}function Qn(e,r,i){return{type:"SliceSelector",start:e,end:r,step:i}}function Bn(e){return{type:"FilterSelector",expr:e}}function _n(e,r){return _t(e,r)}function Un(e,r){return _t(e,r)}function Wn(e,r){return e?{type:"LogicalUnary",operator:"!",expr:r}:r}function zn(e,r){return qs(e,{type:"TestExpr",query:r})}function Gn(e){return{type:"CurrentNode",segments:e}}function Hn(e,r,i){return{type:"ComparisonExpr",left:e,operator:r,right:i}}function qn(e){return{type:"Literal",member:e}}function Xn(e){return{type:"CurrentNode",segments:e}}function Kn(e){return{type:"Root",segments:e}}function uo(e){return e}function Yn(e){return[e]}function Zn(e){return[e]}function es(e){return[e]}function ts(e,r,i){return parseFloat(`${e}${r??""}${i?`e${i}`:""}`)}function rs(e,r){return parseInt(`${e||""}${r.join("")}`)}function ns(){return!0}function ss(){return!1}function os(){return null}function is(e,r){let i=r[0],f=r[1];return{type:"FunctionExpr",name:e,args:[i].concat(f)}}function fs(e){return[e]}function ls(e,r){return[e].concat(r)}function as(){return{type:"MemberNameShorthand",member:W()}}function cs(e){return Array.isArray(e)?{type:"DescendantSegment",selectors:e}:{type:"DescendantSegment",selectors:[e]}}let s=o.peg$currPos|0,m=s,U=[{line:1,column:1}],J=s,ae=o.peg$maxFailExpected||[],p=o.peg$silentFails|0,K;if(o.startRule){if(!(o.startRule in g))throw new Error(`Can't start parsing from rule "`+o.startRule+'".');h=g[o.startRule]}function W(){return n.substring(m,s)}function po(){return m}function go(){return{source:l,start:m,end:s}}function mo(){return Y(m,s)}function yo(e,r){throw r=r!==void 0?r:Y(m,s),ht([gs(e)],n.substring(m,s),r)}function ho(e,r){throw r=r!==void 0?r:Y(m,s),ms(e,r)}function us(e=s){let r=n.codePointAt(e);return r===void 0?"":String.fromCodePoint(r)}function d(e,r){return{type:"literal",text:e,ignoreCase:r}}function L(e,r,i,f){return{type:"class",parts:e,inverted:r,ignoreCase:i,unicode:f}}function $o(){return{type:"any"}}function ps(){return{type:"end"}}function gs(e){return{type:"other",description:e}}function yt(e){let r=U[e],i;if(r)return r;if(e>=U.length)i=U.length-1;else for(i=e;!U[--i];);for(r=U[i],r={line:r.line,column:r.column};i<e;)n.charCodeAt(i)===10?(r.line++,r.column=1):r.column++,i++;return U[e]=r,r}function Y(e,r,i){let f=yt(e),a=yt(r),c={source:l,start:{offset:e,line:f.line,column:f.column},end:{offset:r,line:a.line,column:a.column}};return i&&l&&typeof l.offset=="function"&&(c.start=l.offset(c.start),c.end=l.offset(c.end)),c}function u(e){s<J||(s>J&&(J=s,ae=[]),ae.push(e))}function ms(e,r){return new G(e,null,null,r)}function ht(e,r,i){return new G(G.buildMessage(e,r),e,r,i)}function Ee(){let e,r,i;return e=s,r=Nt(),r!==t?(i=dt(),m=e,e=xn(i)):(s=e,e=t),e}function dt(){let e,r,i,f;for(e=[],r=s,i=N(),f=jt(),f!==t?r=f:(s=r,r=t);r!==t;)e.push(r),r=s,i=N(),f=jt(),f!==t?r=f:(s=r,r=t);return e}function N(){let e,r;for(e=[],r=$t();r!==t;)e.push(r),r=$t();return e}function $t(){let e;return e=n.charAt(s),xr.test(e)?s++:(e=t,p===0&&u(Ir)),e}function Nt(){let e;return n.charCodeAt(s)===36?(e=C,s++):(e=t,p===0&&u(jr)),e}function we(){let e;return e=xt(),e===t&&(e=Je(),e===t&&(e=xs(),e===t&&(e=Lt(),e===t&&(e=As())))),e}function xt(){let e,r;return e=s,r=At(),r!==t&&(m=e,r=An(r)),e=r,e}function At(){let e,r,i,f;if(e=s,n.charCodeAt(s)===34?(r=S,s++):(r=t,p===0&&u(ie)),r!==t){for(i=[],f=Ft();f!==t;)i.push(f),f=Ft();n.charCodeAt(s)===34?(f=S,s++):(f=t,p===0&&u(ie)),f!==t?(m=e,e=Fn(i)):(s=e,e=t)}else s=e,e=t;if(e===t)if(e=s,n.charCodeAt(s)===39?(r=b,s++):(r=t,p===0&&u(fe)),r!==t){for(i=[],f=Ct();f!==t;)i.push(f),f=Ct();n.charCodeAt(s)===39?(f=b,s++):(f=t,p===0&&u(fe)),f!==t?(m=e,e=Cn(i)):(s=e,e=t)}else s=e,e=t;return e}function Ft(){let e,r,i;return e=bt(),e===t&&(n.charCodeAt(s)===39?(e=b,s++):(e=t,p===0&&u(fe)),e===t&&(e=s,r=ce(),r!==t?(n.charCodeAt(s)===34?(i=S,s++):(i=t,p===0&&u(ie)),i!==t?e=i:(s=e,e=t)):(s=e,e=t),e===t&&(e=s,r=ce(),r!==t?(i=St(),i!==t?e=i:(s=e,e=t)):(s=e,e=t)))),e}function Ct(){let e,r,i;return e=bt(),e===t&&(n.charCodeAt(s)===34?(e=S,s++):(e=t,p===0&&u(ie)),e===t&&(e=s,r=ce(),r!==t?(n.charCodeAt(s)===39?(i=b,s++):(i=t,p===0&&u(fe)),i!==t?e=i:(s=e,e=t)):(s=e,e=t),e===t&&(e=s,r=ce(),r!==t?(i=St(),i!==t?e=i:(s=e,e=t)):(s=e,e=t)))),e}function ce(){let e;return n.charCodeAt(s)===92?(e=P,s++):(e=t,p===0&&u(Ce)),e}function bt(){let e,r,i,f;return e=n.charAt(s),Ar.test(e)?s++:(e=t,p===0&&u(Pr)),e===t&&(e=s,r=s,i=n.charAt(s),ot.test(i)?s++:(i=t,p===0&&u(ft)),i!==t?(f=n.charAt(s),it.test(f)?s++:(f=t,p===0&&u(lt)),f!==t?(i=[i,f],r=i):(s=r,r=t)):(s=r,r=t),r!==t?e=n.substring(e,s):e=r),e}function St(){let e,r,i,f;return e=s,n.charCodeAt(s)===98?(r=_,s++):(r=t,p===0&&u(Mr)),r!==t&&(m=e,r=bn()),e=r,e===t&&(e=s,n.charCodeAt(s)===102?(r=re,s++):(r=t,p===0&&u(Vr)),r!==t&&(m=e,r=Sn()),e=r,e===t&&(e=s,n.charCodeAt(s)===110?(r=A,s++):(r=t,p===0&&u(kr)),r!==t&&(m=e,r=Ln()),e=r,e===t&&(e=s,n.charCodeAt(s)===114?(r=x,s++):(r=t,p===0&&u(Qr)),r!==t&&(m=e,r=Tn()),e=r,e===t&&(e=s,n.charCodeAt(s)===116?(r=D,s++):(r=t,p===0&&u(Br)),r!==t&&(m=e,r=En()),e=r,e===t&&(e=s,n.charCodeAt(s)===47?(r=k,s++):(r=t,p===0&&u(_r)),r!==t&&(m=e,r=wn()),e=r,e===t&&(e=s,n.charCodeAt(s)===92?(r=P,s++):(r=t,p===0&&u(Ce)),r!==t&&(m=e,r=Jn()),e=r,e===t&&(e=s,r=s,n.charCodeAt(s)===117?(i=ze,s++):(i=t,p===0&&u(at)),i!==t?(f=ys(),f!==t?r=f:(s=r,r=t)):(s=r,r=t),r!==t&&(m=e,r=Dn(r)),e=r))))))),e}function ys(){let e,r,i,f,a,c;return e=s,r=hs(),r!==t&&(m=e,r=vn(r)),e=r,e===t&&(e=s,r=s,i=ds(),i!==t?(n.charCodeAt(s)===92?(f=P,s++):(f=t,p===0&&u(Ce)),f!==t?(n.charCodeAt(s)===117?(a=ze,s++):(a=t,p===0&&u(at)),a!==t?(c=$s(),c!==t?r=[i,c]:(s=r,r=t)):(s=r,r=t)):(s=r,r=t)):(s=r,r=t),r!==t&&(m=e,r=r),e=r),e}function hs(){let e,r,i,f,a,c,$;if(e=s,r=s,i=j(),i===t&&(i=n.charAt(s),Fr.test(i)?s++:(i=t,p===0&&u(Ur))),i!==t){for(f=s,a=[],c=M();c!==t;)a.push(c),a.length>=3?c=t:c=M();a.length<3?(s=f,f=t):f=a,f!==t?(i=[i,f],r=i):(s=r,r=t)}else s=r,r=t;if(r!==t&&(m=e,r=Rn()),e=r,e===t){if(e=s,r=s,i=n.charAt(s),i.toLowerCase()===Ne?s++:(i=t,p===0&&u(be)),i!==t)if(f=n.charAt(s),Cr.test(f)?s++:(f=t,p===0&&u(Wr)),f!==t){for(a=s,c=[],$=M();$!==t;)c.push($),c.length>=2?$=t:$=M();c.length<2?(s=a,a=t):a=c,a!==t?(i=[i,f,a],r=i):(s=r,r=t)}else s=r,r=t;else s=r,r=t;r!==t&&(m=e,r=On()),e=r}return e}function ds(){let e,r,i,f,a,c;if(e=s,r=n.charAt(s),r.toLowerCase()===Ne?s++:(r=t,p===0&&u(be)),r!==t)if(i=n.charAt(s),br.test(i)?s++:(i=t,p===0&&u(zr)),i!==t){for(f=s,a=[],c=M();c!==t;)a.push(c),a.length>=2?c=t:c=M();a.length<2?(s=f,f=t):f=a,f!==t?(m=e,e=In()):(s=e,e=t)}else s=e,e=t;else s=e,e=t;return e}function $s(){let e,r,i,f,a,c;if(e=s,r=n.charAt(s),r.toLowerCase()===Ne?s++:(r=t,p===0&&u(be)),r!==t)if(i=n.charAt(s),Sr.test(i)?s++:(i=t,p===0&&u(Gr)),i!==t){for(f=s,a=[],c=M();c!==t;)a.push(c),a.length>=2?c=t:c=M();a.length<2?(s=f,f=t):f=a,f!==t?(m=e,e=jn()):(s=e,e=t)}else s=e,e=t;else s=e,e=t;return e}function M(){let e;return e=j(),e===t&&(e=n.charAt(s),Lr.test(e)?s++:(e=t,p===0&&u(Hr))),e}function Je(){let e,r;return e=s,n.charCodeAt(s)===42?(r=gr,s++):(r=t,p===0&&u(qr)),r!==t&&(m=e,r=Pn()),e=r,e}function Lt(){let e,r;return e=s,r=Z(),r!==t&&(m=e,r=Mn(r)),e=r,e}function Z(){let e,r,i,f,a,c;if(e=s,n.charCodeAt(s)===48?(r=mr,s++):(r=t,p===0&&u(Xr)),r!==t&&(m=e,r=Vn()),e=r,e===t){if(e=s,r=s,n.charCodeAt(s)===45?(i=yr,s++):(i=t,p===0&&u(Kr)),i===t&&(i=null),f=Ns(),f!==t){for(a=[],c=j();c!==t;)a.push(c),c=j();i=[i,f,a],r=i}else s=r,r=t;r!==t&&(m=e,r=kn()),e=r}return e}function Ns(){let e;return e=n.charAt(s),Tr.test(e)?s++:(e=t,p===0&&u(Yr)),e}function xs(){let e,r,i,f,a,c,$,y,Q,T;return e=s,r=s,i=Z(),i!==t?(f=N(),r=i):(s=r,r=t),r===t&&(r=null),n.charCodeAt(s)===58?(i=Ge,s++):(i=t,p===0&&u(ct)),i!==t?(f=N(),a=s,c=Z(),c!==t?($=N(),a=c):(s=a,a=t),a===t&&(a=null),c=s,n.charCodeAt(s)===58?($=Ge,s++):($=t,p===0&&u(ct)),$!==t?(y=s,Q=N(),T=Z(),T!==t?y=T:(s=y,y=t),y===t&&(y=null),c=y):(s=c,c=t),c===t&&(c=null),m=e,e=Qn(r,a,c)):(s=e,e=t),e}function As(){let e,r,i,f;return e=s,n.charCodeAt(s)===63?(r=hr,s++):(r=t,p===0&&u(Zr)),r!==t?(i=N(),f=De(),f!==t?(m=e,e=Bn(f)):(s=e,e=t)):(s=e,e=t),e}function De(){let e,r,i,f,a,c,$,y;if(e=s,r=ve(),r!==t){for(i=[],f=s,a=N(),n.substr(s,2)===ne?(c=ne,s+=2):(c=t,p===0&&u(ut)),c!==t?($=N(),y=ve(),y!==t?(a=[a,c,$,y],f=a):(s=f,f=t)):(s=f,f=t);f!==t;)i.push(f),f=s,a=N(),n.substr(s,2)===ne?(c=ne,s+=2):(c=t,p===0&&u(ut)),c!==t?($=N(),y=ve(),y!==t?(a=[a,c,$,y],f=a):(s=f,f=t)):(s=f,f=t);m=e,e=_n(r,i)}else s=e,e=t;return e}function ve(){let e,r,i,f,a,c,$,y;if(e=s,r=Re(),r!==t){for(i=[],f=s,a=N(),n.substr(s,2)===se?(c=se,s+=2):(c=t,p===0&&u(pt)),c!==t?($=N(),y=Re(),y!==t?(a=[a,c,$,y],f=a):(s=f,f=t)):(s=f,f=t);f!==t;)i.push(f),f=s,a=N(),n.substr(s,2)===se?(c=se,s+=2):(c=t,p===0&&u(pt)),c!==t?($=N(),y=Re(),y!==t?(a=[a,c,$,y],f=a):(s=f,f=t)):(s=f,f=t);m=e,e=Un(r,i)}else s=e,e=t;return e}function Re(){let e;return e=Fs(),e===t&&(e=Ss(),e===t&&(e=Cs())),e}function Fs(){let e,r,i,f,a,c,$;return e=s,r=s,i=Tt(),i!==t?(f=N(),r=i):(s=r,r=t),r===t&&(r=null),n.charCodeAt(s)===40?(i=He,s++):(i=t,p===0&&u(gt)),i!==t?(f=N(),a=De(),a!==t?(c=N(),n.charCodeAt(s)===41?($=qe,s++):($=t,p===0&&u(mt)),$!==t?(m=e,e=Wn(r,a)):(s=e,e=t)):(s=e,e=t)):(s=e,e=t),e}function Tt(){let e;return n.charCodeAt(s)===33?(e=dr,s++):(e=t,p===0&&u(en)),e}function Cs(){let e,r,i,f;return e=s,r=s,i=Tt(),i!==t?(f=N(),r=i):(s=r,r=t),r===t&&(r=null),i=Et(),i===t&&(i=Oe()),i!==t?(m=e,e=zn(r,i)):(s=e,e=t),e}function Et(){let e;return e=bs(),e===t&&(e=Ee()),e}function bs(){let e,r,i;return e=s,r=wt(),r!==t?(i=dt(),i!==t?(m=e,e=Gn(i)):(s=e,e=t)):(s=e,e=t),e}function wt(){let e;return n.charCodeAt(s)===64?(e=$r,s++):(e=t,p===0&&u(tn)),e}function Ss(){let e,r,i,f,a,c;return e=s,r=Dt(),r!==t?(i=N(),f=Ls(),f!==t?(a=N(),c=Dt(),c!==t?(m=e,e=Hn(r,f,c)):(s=e,e=t)):(s=e,e=t)):(s=e,e=t),e}function Jt(){let e,r;return e=s,r=Js(),r===t&&(r=At(),r===t&&(r=Rs(),r===t&&(r=Os(),r===t&&(r=Is())))),r!==t&&(m=e,r=qn(r)),e=r,e}function Dt(){let e;return e=Jt(),e===t&&(e=Ts(),e===t&&(e=Oe())),e}function Ls(){let e;return n.substr(s,2)===Xe?(e=Xe,s+=2):(e=t,p===0&&u(rn)),e===t&&(n.substr(s,2)===Ke?(e=Ke,s+=2):(e=t,p===0&&u(nn)),e===t&&(n.substr(s,2)===Ye?(e=Ye,s+=2):(e=t,p===0&&u(sn)),e===t&&(n.substr(s,2)===Ze?(e=Ze,s+=2):(e=t,p===0&&u(on)),e===t&&(e=n.charAt(s),Er.test(e)?s++:(e=t,p===0&&u(fn)))))),e}function Ts(){let e;return e=Es(),e===t&&(e=ws()),e}function Es(){let e,r,i;return e=s,r=wt(),r!==t?(i=vt(),m=e,e=Xn(i)):(s=e,e=t),e}function ws(){let e,r,i;return e=s,r=Nt(),r!==t?(i=vt(),m=e,e=Kn(i)):(s=e,e=t),e}function vt(){let e,r,i,f,a;for(e=s,r=[],i=s,f=N(),a=Rt(),a===t&&(a=Ot()),a!==t?i=a:(s=i,i=t);i!==t;)r.push(i),i=s,f=N(),a=Rt(),a===t&&(a=Ot()),a!==t?i=a:(s=i,i=t);return m=e,r=r,e=r,e}function Rt(){let e,r,i,f;return e=s,n.charCodeAt(s)===91?(r=xe,s++):(r=t,p===0&&u(Se)),r!==t?(i=xt(),i!==t?(n.charCodeAt(s)===93?(f=Ae,s++):(f=t,p===0&&u(Le)),f!==t?(m=e,e=Yn(i)):(s=e,e=t)):(s=e,e=t)):(s=e,e=t),e===t&&(e=s,n.charCodeAt(s)===46?(r=Fe,s++):(r=t,p===0&&u(Te)),r!==t?(i=je(),i!==t?(m=e,e=Zn(i)):(s=e,e=t)):(s=e,e=t)),e}function Ot(){let e,r,i,f;return e=s,n.charCodeAt(s)===91?(r=xe,s++):(r=t,p===0&&u(Se)),r!==t?(i=Lt(),i!==t?(n.charCodeAt(s)===93?(f=Ae,s++):(f=t,p===0&&u(Le)),f!==t?(m=e,e=es(i)):(s=e,e=t)):(s=e,e=t)):(s=e,e=t),e}function Js(){let e,r,i,f;return e=s,r=Z(),r===t&&(n.substr(s,2)===et?(r=et,s+=2):(r=t,p===0&&u(ln))),r!==t?(i=Ds(),i===t&&(i=null),f=vs(),f===t&&(f=null),m=e,e=ts(r,i,f)):(s=e,e=t),e}function Ds(){let e,r,i,f,a;if(e=s,r=s,n.charCodeAt(s)===46?(i=Fe,s++):(i=t,p===0&&u(Te)),i!==t){if(f=[],a=j(),a!==t)for(;a!==t;)f.push(a),a=j();else f=t;f!==t?(i=[i,f],r=i):(s=r,r=t)}else s=r,r=t;return r!==t?e=n.substring(e,s):e=r,e}function vs(){let e,r,i,f,a;if(e=s,r=n.charAt(s),r.toLowerCase()===Nr?s++:(r=t,p===0&&u(an)),r!==t){if(i=n.charAt(s),wr.test(i)?s++:(i=t,p===0&&u(cn)),i===t&&(i=null),f=[],a=j(),a!==t)for(;a!==t;)f.push(a),a=j();else f=t;f!==t?(m=e,e=rs(i,f)):(s=e,e=t)}else s=e,e=t;return e}function Rs(){let e,r;return e=s,n.substr(s,4)===tt?(r=tt,s+=4):(r=t,p===0&&u(un)),r!==t&&(m=e,r=ns()),e=r,e}function Os(){let e,r;return e=s,n.substr(s,5)===rt?(r=rt,s+=5):(r=t,p===0&&u(pn)),r!==t&&(m=e,r=ss()),e=r,e}function Is(){let e,r;return e=s,n.substr(s,4)===nt?(r=nt,s+=4):(r=t,p===0&&u(gn)),r!==t&&(m=e,r=os()),e=r,e}function js(){let e,r,i,f,a;if(e=s,r=s,i=Ps(),i!==t){for(f=[],a=It();a!==t;)f.push(a),a=It();i=[i,f],r=i}else s=r,r=t;return r!==t?e=n.substring(e,s):e=r,e}function It(){let e;return e=n.charAt(s),Jr.test(e)?s++:(e=t,p===0&&u(mn)),e}function Ps(){let e;return e=n.charAt(s),Dr.test(e)?s++:(e=t,p===0&&u(yn)),e}function Oe(){let e,r,i,f,a,c,$,y,Q,T,Qt,z;if(e=s,r=js(),r!==t)if(n.charCodeAt(s)===40?(i=He,s++):(i=t,p===0&&u(gt)),i!==t){if(f=N(),a=s,c=Ie(),c!==t){for($=[],y=s,Q=N(),n.charCodeAt(s)===44?(T=oe,s++):(T=t,p===0&&u(le)),T!==t?(Qt=N(),z=Ie(),z!==t?y=z:(s=y,y=t)):(s=y,y=t);y!==t;)$.push(y),y=s,Q=N(),n.charCodeAt(s)===44?(T=oe,s++):(T=t,p===0&&u(le)),T!==t?(Qt=N(),z=Ie(),z!==t?y=z:(s=y,y=t)):(s=y,y=t);a=[c,$]}else s=a,a=t;a===t&&(a=null),c=N(),n.charCodeAt(s)===41?($=qe,s++):($=t,p===0&&u(mt)),$!==t?(m=e,e=is(r,a)):(s=e,e=t)}else s=e,e=t;else s=e,e=t;return e}function Ie(){let e;return e=Jt(),e===t&&(e=Et(),e===t&&(e=Oe(),e===t&&(e=De()))),e}function jt(){let e;return e=Ms(),e===t&&(e=ks()),e}function Ms(){let e,r,i;return e=Pt(),e===t&&(e=s,n.charCodeAt(s)===46?(r=Fe,s++):(r=t,p===0&&u(Te)),r!==t?(i=Je(),i===t&&(i=je()),i!==t?(m=e,e=fs(i)):(s=e,e=t)):(s=e,e=t)),e}function Pt(){let e,r,i,f,a,c,$,y,Q,T;if(e=s,n.charCodeAt(s)===91?(r=xe,s++):(r=t,p===0&&u(Se)),r!==t)if(i=N(),f=we(),f!==t){for(a=[],c=s,$=N(),n.charCodeAt(s)===44?(y=oe,s++):(y=t,p===0&&u(le)),y!==t?(Q=N(),T=we(),T!==t?c=T:(s=c,c=t)):(s=c,c=t);c!==t;)a.push(c),c=s,$=N(),n.charCodeAt(s)===44?(y=oe,s++):(y=t,p===0&&u(le)),y!==t?(Q=N(),T=we(),T!==t?c=T:(s=c,c=t)):(s=c,c=t);c=N(),n.charCodeAt(s)===93?($=Ae,s++):($=t,p===0&&u(Le)),$!==t?(m=e,e=ls(f,a)):(s=e,e=t)}else s=e,e=t;else s=e,e=t;return e}function je(){let e,r,i,f;if(e=s,r=Mt(),r!==t){for(i=[],f=Vt();f!==t;)i.push(f),f=Vt();m=e,e=as()}else s=e,e=t;return e}function Mt(){let e,r,i,f;return e=Vs(),e===t&&(e=n.charAt(s),vr.test(e)?s++:(e=t,p===0&&u(hn)),e===t&&(e=s,r=s,i=n.charAt(s),ot.test(i)?s++:(i=t,p===0&&u(ft)),i!==t?(f=n.charAt(s),it.test(f)?s++:(f=t,p===0&&u(lt)),f!==t?(i=[i,f],r=i):(s=r,r=t)):(s=r,r=t),r!==t?e=n.substring(e,s):e=r)),e}function Vt(){let e;return e=j(),e===t&&(e=Mt()),e}function j(){let e;return e=n.charAt(s),Rr.test(e)?s++:(e=t,p===0&&u(dn)),e}function Vs(){let e;return e=n.charAt(s),Or.test(e)?s++:(e=t,p===0&&u($n)),e}function ks(){let e,r,i;return e=s,n.substr(s,2)===st?(r=st,s+=2):(r=t,p===0&&u(Nn)),r!==t?(i=Pt(),i===t&&(i=Je(),i===t&&(i=je())),i!==t?(m=e,e=cs(i)):(s=e,e=t)):(s=e,e=t),e}K=h();let Pe=K!==t&&s===n.length;function kt(){throw K!==t&&s<n.length&&u(ps()),ht(ae,J<n.length?us(J):null,J<n.length?Y(J,J+1):Y(J,J))}if(o.peg$library)return{peg$result:K,peg$currPos:s,peg$FAILED:t,peg$maxFailExpected:ae,peg$maxFailPos:J,peg$success:Pe,peg$throw:Pe?void 0:kt};if(Pe)return K;kt()}Ut.exports={StartRules:["JsonpathQuery"],SyntaxError:G,parse:Xs}});var pr=Hs(Wt());var zt=Symbol("NodeType");function ue(n,o){return{[zt]:void 0,value:n,path:o}}function ee(n,o,t){return ue(o,[...n.path,t])}function V(n,o,t){return ue(o,[...n.path,t])}function Me(n){return typeof n=="object"&&n!==null&&zt in n}function Ve(n){return Array.isArray(n)?n.every(Me):!1}var v=n=>n!==null&&typeof n=="object"&&!Array.isArray(n),H=n=>n===null||n===!0||n===!1||typeof n=="string"||typeof n=="number",te=n=>Array.isArray(n);function pe(n){let{value:o}=n;return H(o)?[]:te(o)?o.map((t,l)=>V(n,t,l)):v(o)?Object.entries(o).map(([t,l])=>ee(n,l,t)):[]}var ke=n=>{let o=[];o.push(n);for(let t of pe(n))o.push(...ke(t));return o};function Ht(n,o){if(!Array.isArray(o.value))return[];let t=n.step??1,l=n.start??(t>=0?0:o.value.length-1),g=n.end??(t>=0?o.value.length:-o.value.length-1),h=[],[C,S]=Ks(l,g,t,o.value.length);if(t>0)for(let b=C;b<S;b+=t)h.push(V(o,o.value[b],b));else if(t<0)for(let b=S;C<b;b+=t)h.push(V(o,o.value[b],b));return h}function Gt(n,o){return n>=0?n:o+n}function Ks(n,o,t,l){let g=Gt(n,l),h=Gt(o,l),C,S;return t>=0?(C=Math.min(Math.max(g,0),l),S=Math.min(Math.max(h,0),l)):(S=Math.min(Math.max(g,-1),l-1),C=Math.min(Math.max(h,-1),l-1)),[C,S]}function R(n,o){return Qe(n,o)}function Qe(n,o,t=new WeakMap){if(n===o)return!0;if(typeof n!=typeof o||n===null||o===null)return!1;if(Array.isArray(n)&&Array.isArray(o))return n.length!==o.length?!1:n.every((l,g)=>Qe(l,o[g],t));if(Array.isArray(n)||Array.isArray(o))return!1;if(typeof n=="object"&&typeof o=="object"){if(t.has(n))return t.get(n)===o;t.set(n,o);let l=Object.keys(n),g=Object.keys(o);return l.length!==g.length?!1:l.every(h=>Qe(n[h],o[h],t))}return!1}var qt={"=="(n,o){return R(n,o)},"!="(n,o){return!R(n,o)},"<"(){return!1},"<="(n,o){return R(n,o)},">"(){return!1},">="(n,o){return R(n,o)}};var Xt={"=="(n,o){return n===o},"!="(n,o){return n!==o},"<"(){return!1},"<="(n,o){return n===o},">"(){return!1},">="(n,o){return n===o}};var F={__type:"Nothing"};var Kt={"=="(n,o){return(n===F||o===F)&&n===o},"!="(n,o){return(n===F||o===F)&&n!==o},"<"(){return!1},"<="(n,o){return(n===F||o===F)&&n===o},">"(){return!1},">="(n,o){return(n===F||o===F)&&n===o}};var Yt={"=="(n,o){return n===o},"!="(n,o){return n!==o},"<"(){return!1},"<="(n,o){return n===o},">"(){return!1},">="(n,o){return n===o}};var Zt={"=="(n,o){return n===o},"!="(n,o){return n!==o},"<"(n,o){return typeof o!="number"?!1:n<o},"<="(n,o){return typeof o!="number"?!1:n<=o},">"(n,o){return typeof o!="number"?!1:n>o},">="(n,o){return typeof o!="number"?!1:n>=o}};var er={"=="(n,o){return R(n,o)},"!="(n,o){return!R(n,o)},"<"(){return!1},"<="(n,o){return R(n,o)},">"(){return!1},">="(n,o){return R(n,o)}};var tr={"=="(n,o){return n===o},"!="(n,o){return n!==o},"<"(n,o){return n<o},"<="(n,o){return n<=o},">"(n,o){return n>o},">="(n,o){return n>=o}};var E;(t=>(t.LogicalTrue={type:"LogicalType"},t.LogicalFalse={type:"LogicalFalse"}))(E||={});var ge=n=>n?E.LogicalTrue:E.LogicalFalse,Be=n=>n===E.LogicalTrue||n===E.LogicalFalse;var w={type:"ValueType",convert:n=>{if(n===F||H(n))return n;if(Me(n))return n.value;if(Ve(n)){if(n.length===0)return F;if(n.length===1)return n[0].value}throw new Error(`Invalid argument type "${JSON.stringify(n)}" is not a ValueType`)}},me={type:"NodesType",convert:n=>{if(Ve(n))return n;throw new Error(`Invalid argument type "${JSON.stringify(n)}" is not a NodesType`)}},ye={type:"LogicalType",convert:n=>{if(n===!0)return E.LogicalTrue;if(n===!1)return E.LogicalFalse;if(Array.isArray(n)){if(n.length===0)return E.LogicalFalse;if(n.length>=1)return E.LogicalTrue}throw new Error(`Invalid argument type "${JSON.stringify(n)}" is not a LogicalType`)}},O=n=>n,q=(n,o)=>{let t=n.args;if(o.length!==t.length)throw new Error(`Invalid number of arguments: ${n.name} function requires ${t.length} arguments but received ${o.length}`);return t.map((g,h)=>g.convert(o[h]))};var rr=O({name:"length",args:[me],return:w,function:n=>n.length});var nr=O({name:"length",args:[w],return:w,function:n=>n===F?F:typeof n=="string"||Array.isArray(n)?n.length:v(n)?Object.keys(n).length:F});var he=n=>{let o="",t=!1,l=!1;for(let g=0;g<n.length;g++){let h=n[g];if(l){o+=`\\${h}`,l=!1;continue}if(h==="\\"){l=!0;continue}if(h==="["){t=!0,o+=h;continue}if(h==="]"){t=!1,o+=h;continue}h==="."&&!t&&!l?o+="[^\\n\\r]":o+=h}if(l)throw new Error("Invalid I-Regexp: ends with a backslash escape.");return o};var sr=O({name:"match",args:[w,w],return:ye,function:(n,o)=>{if(typeof n!="string"||typeof o!="string")return E.LogicalFalse;let t=he(o),l=new RegExp(`^(?:${t})$`,"u").test(n);return ge(l)}});var or=O({name:"search",args:[w,w],return:ye,function:(n,o)=>{if(typeof n!="string"||typeof o!="string")return E.LogicalFalse;let t=he(o),l=new RegExp(t,"u").test(n);return ge(l)}});var ir=O({name:"value",args:[me],return:w,function:n=>n.length===1?n[0].value:F});var I={length:nr,count:rr,match:sr,search:or,value:ir},de=(n,o,t)=>{let l=n.args.map(g=>Ys(g,o,t));switch(n.name){case"length":{let g=q(I.length,l);return I.length.function.call(void 0,...g)}case"count":{let g=q(I.count,l);return I.count.function.call(void 0,...g)}case"match":{let g=q(I.match,l);return I.match.function.call(void 0,...g)}case"search":{let g=q(I.search,l);return I.search.function.call(void 0,...g)}case"value":{let g=q(I.value,l);return I.value.function.call(void 0,...g)}}return F},Ys=(n,o,t)=>{switch(n.type){case"Literal":return n.member;case"CurrentNode":return $e(n,o,[t]);case"Root":return B(n,o);case"FunctionExpr":return de(n,o,t);default:throw new Error(`Unknown argument type "${n.type}"`)}};function lr(n,o,t){return H(t.value)?[]:pe(t).filter(l=>X(n.expr,o,l))}var X=(n,o,t)=>{let l=n.type;switch(l){case"ComparisonExpr":return Zs(n,o,t);case"TestExpr":return to(n,o,t);case"LogicalBinary":case"LogicalUnary":return no(n,o,t);default:}return!1},Zs=(n,o,t)=>{let l=fr(n.left,o,t),g=fr(n.right,o,t);return eo(l,g,n.operator)},eo=(n,o,t)=>{if(n===F||o===F)return Kt[t](n,o);let l=n,g=o;if(Be(l)||Be(g))throw new Error("LogicalType can't be compared");return v(l)&&v(g)?er[t](l,g):te(l)&&te(g)?qt[t](l,g):typeof l=="number"&&typeof g=="number"?Zt[t](l,g):typeof l=="string"&&typeof g=="string"?tr[t](l,g):typeof l=="boolean"&&typeof g=="boolean"?Xt[t](l,g):l===null&&g===null?Yt[t](l,g):t==="!="},$e=(n,o,t)=>_e(n.segments,o,t),fr=(n,o,t)=>{switch(n.type){case"Literal":return n.member;case"CurrentNode":{let l=$e(n,o,[t]);return l[0]===void 0?F:l[0].value}case"Root":return B(n,o)[0]?.value??F;case"FunctionExpr":return de(n,o,t)}},to=(n,o,t)=>ro(n.query,o,t),ro=(n,o,t)=>{switch(n.type){case"FunctionExpr":{let l=de(n,o,t);if(l===E.LogicalTrue)return!0;if(l===E.LogicalFalse)return!1;if(Array.isArray(l))return l.length>0;throw new Error(`Function ${n.name} result must be compared`)}case"CurrentNode":return $e(n,o,[t]).length>0;case"Root":return B(n,o).length>0}return!1},no=(n,o,t)=>{switch(n.operator){case"||":return so(n,o,t);case"&&":return oo(n,o,t);case"!":return io(n,o,t)}},so=(n,o,t)=>{let l=X(n.left,o,t),g=X(n.right,o,t);return l||g},oo=(n,o,t)=>{let l=X(n.left,o,t),g=X(n.right,o,t);return l&&g},io=(n,o,t)=>!X(n.expr,o,t);function B(n,o){return _e(n.segments,o,[o])}function _e(n,o,t){return n.reduce((g,h)=>g.flatMap(C=>fo(h,o,C)),t)}function fo(n,o,t){return Array.isArray(n)?n.map(C=>ar(C,o,t)).flat().filter(C=>C!==void 0):ke(t).flatMap(g=>n.selectors.flatMap(h=>ar(h,o,g)))}function ar(n,o,t){let l=n.type;switch(l){case"WildcardSelector":return lo(n,t);case"IndexSelector":return ao(n,t);case"SliceSelector":return Ht(n,t);case"MemberNameShorthand":return cr(n,t);case"NameSelector":return cr(n,t);case"FilterSelector":return lr(n,o,t);default:return l}}function lo(n,o){let t=[],l=o.value;if(Array.isArray(l))for(let g in l)Object.hasOwn(l,g)&&t.push(V(o,l[g],Number(g)));else if(v(l))for(let g in l)Object.hasOwn(l,g)&&t.push(ee(o,l[g],g));return t}function cr(n,o){return v(o.value)?n.member in o.value?[ee(o,o.value[n.member],n.member)]:[]:[]}function ao(n,o){if(Array.isArray(o.value)){let t=n.index<0?o.value.length+n.index:n.index;if(0<=t&&t<o.value.length){let l=o.value.at(t);return l===void 0?[]:[V(o,l,t)]}return[]}return[]}function Ue(n,o){let t=ue(n,["$"]);return B(o,t)}var ur=n=>n.replace(/['\\\b\f\n\r\t\u0000-\u001F]/g,o=>{switch(o){case"'":return"\\'";case"\\":return"\\\\";case"\b":return"\\b";case"\f":return"\\f";case`
`:return"\\n";case"\r":return"\\r";case"	":return"\\t";default:return`\\u${o.charCodeAt(0).toString(16).padStart(4,"0")}`}});var We=class{rootNode;constructor(o){let t=(0,pr.parse)(o);this.rootNode=t}find(o){return Ue(o,this.rootNode).filter(l=>l!==void 0).map(l=>l.value)}#e(o){return typeof o=="string"?o==="$"?"$":`['${ur(o)}']`:`[${o}]`}paths(o){return this.pathSegments(o).map(t=>({value:t.value,path:"$"+t.segments.map(l=>this.#e(l)).join("")}))}pathSegments(o){return Ue(o,this.rootNode).filter(l=>l!==void 0).map(l=>({value:l.value,segments:l.path.slice(1)}))}};export{We as JSONPathJS};
